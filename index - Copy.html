<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kladionice Tips - Tamna Tema</title>
<style>
  body {
    margin:0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
      Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    background:#121212; color:#eee;
    min-height:100vh; display:flex; flex-direction:column;
  }
  header, footer {
    background:#1e1e1e; padding:1rem 2rem;
    text-align:center; font-weight:700; font-size:1.25rem;
    box-shadow: 0 1px 5px rgba(0,0,0,0.5);
  }
  main { flex:1; max-width:800px; margin:1rem auto; padding:0 1rem; }
  a { color:#0af; text-decoration:none; }
  a:hover { text-decoration:underline; }
  nav a { margin: 0 0.75rem; font-weight:600; }
  button {
    background:#0af; border:none; color:#111; padding:0.5rem 1rem;
    border-radius:4px; cursor:pointer; font-weight:600;
  }
  button:hover { background:#08c; }
  input, textarea, select {
    width:100%; padding:0.5rem; margin:0.25rem 0 1rem 0;
    border-radius:4px; border:none; font-size:1rem;
    background:#222; color:#eee;
    box-sizing: border-box;
  }
  textarea { resize: vertical; }
  .tip-card {
    background:#222; padding:1rem; border-radius:6px;
    margin-bottom:1rem; box-shadow:0 2px 6px rgba(0,0,0,0.7);
  }
  .tip-title { font-weight:700; font-size:1.2rem; margin-bottom:0.25rem; }
  .tip-meta { font-size:0.8rem; color:#bbb; margin-bottom:0.5rem; }
  .form-group { margin-bottom:1rem; }
  .nav-active { text-decoration: underline; }
</style>
</head>
<body>

<header>
  <nav>
    <a href="#/" id="nav-home">Početna</a>
    <a href="#/tips" id="nav-tips">Tipovi</a>
    <a href="#/submit" id="nav-submit">Pošalji tip</a>
    <a href="#/login" id="nav-login">Prijava</a>
  </nav>
</header>

<main id="app"></main>

<footer>
  Odgovorno klađenje. Samo punoletni korisnici (18+).
</footer>

<!-- Firebase Initialization -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, 
    signOut,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";

  // Your Firebase Config (already filled in)
  const firebaseConfig = {
    apiKey: "AIzaSyAKXyXWzInd_eL_tG3TBGozEqQcU8UX68c",
    authDomain: "perketips.firebaseapp.com",
    projectId: "perketips",
    storageBucket: "perketips.firebasestorage.app",
    messagingSenderId: "775328891111",
    appId: "1:775328891111:web:62cd27969b82d78eba2242"
  };

  const appFirebase = initializeApp(firebaseConfig);
  const auth = getAuth(appFirebase);

  // Make Firebase accessible to main script
  window.auth = auth;
  window.signInWithEmailAndPassword = signInWithEmailAndPassword;
  window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
  window.signOut = signOut;
  window.onAuthStateChanged = onAuthStateChanged;
</script>

<!-- Main App Logic -->
<script>
(() => {
  const app = document.getElementById('app');
  let currentUser = null;
  let tips = JSON.parse(localStorage.getItem('kt_tips') || '[]');

  if (tips.length === 0) {
    tips = [
      {id:1, title:'Dinamo - Partizan 1X', sport:'Fudbal', odds:'1.85', content:'Očekujemo defanzivnu utakmicu. Manje od 2.5 gola.', author:'Admin', date:'2025-08-10'},
      {id:2, title:'Zvezda, Total >2.5', sport:'Fudbal', odds:'2.10', content:'Napadački sastav, očekujemo više golova.', author:'Expert', date:'2025-08-09'}
    ];
    localStorage.setItem('kt_tips', JSON.stringify(tips));
  }

  function formatDate(d) {
    const dt = new Date(d);
    return dt.toLocaleDateString('sr-RS');
  }

  function setActiveNav(route) {
    ['home','tips','submit','login'].forEach(id=>{
      const el = document.getElementById('nav-'+id);
      if(el) el.classList.remove('nav-active');
    });
    if(route==='/' || route==='') document.getElementById('nav-home').classList.add('nav-active');
    else if(route.startsWith('/tips')) document.getElementById('nav-tips').classList.add('nav-active');
    else if(route==='submit') document.getElementById('nav-submit').classList.add('nav-active');
    else if(route==='login') document.getElementById('nav-login').classList.add('nav-active');
  }

  function router() {
    const hash = location.hash.slice(1) || '/';
    setActiveNav(hash);

    if(hash==='/' || hash==='') renderHome();
    else if(hash.startsWith('/tips/')) renderTipDetail(hash.split('/')[2]);
    else if(hash==='/tips') renderTipsList();
    else if(hash==='submit') renderSubmitForm();
    else if(hash==='login') renderLogin();
    else renderNotFound();
  }

  function renderHome() {
    app.innerHTML = `
      <h1>Dobrodošli na Kladionice Tips</h1>
      <p>Brzi i jasni tipovi za klađenje, prijava korisnika i mogućnost slanja sopstvenih predloga.</p>
      <section>
        ${tips.slice(0,3).map(t=>`
          <div class="tip-card">
            <div class="tip-title">${t.title}</div>
            <div class="tip-meta">${t.sport} — kvota ${t.odds} — ${formatDate(t.date)}</div>
            <p>${t.content.length>100 ? t.content.slice(0,100)+'...' : t.content}</p>
            <a href="#/tips/${t.id}">Detalji</a>
          </div>
        `).join('')}
      </section>
    `;
  }

  function renderTipsList() {
    app.innerHTML = `
      <h1>Svi tipovi</h1>
      <input type="text" id="search" placeholder="Pretraži tipove..." style="margin-bottom:1rem;" />
      <section id="tips-list">
        ${tips.map(t=>`
          <div class="tip-card">
            <div class="tip-title">${t.title}</div>
            <div class="tip-meta">${t.sport} — kvota ${t.odds} — ${formatDate(t.date)}</div>
            <p>${t.content.length>140 ? t.content.slice(0,140)+'...' : t.content}</p>
            <a href="#/tips/${t.id}">Detalji</a>
          </div>
        `).join('')}
      </section>
    `;
    document.getElementById('search').addEventListener('input', e => {
      const q = e.target.value.toLowerCase();
      const filtered = tips.filter(t =>
        t.title.toLowerCase().includes(q) ||
        t.content.toLowerCase().includes(q) ||
        t.sport.toLowerCase().includes(q)
      );
      document.getElementById('tips-list').innerHTML = filtered.length
        ? filtered.map(t=>`
          <div class="tip-card">
            <div class="tip-title">${t.title}</div>
            <div class="tip-meta">${t.sport} — kvota ${t.odds} — ${formatDate(t.date)}</div>
            <p>${t.content.length>140 ? t.content.slice(0,140)+'...' : t.content}</p>
            <a href="#/tips/${t.id}">Detalji</a>
          </div>
        `).join('')
        : '<p>Nema rezultata.</p>';
    });
  }

  function renderTipDetail(id) {
    const tip = tips.find(t => String(t.id) === String(id));
    if(!tip) {
      app.innerHTML = `<p>Tip nije pronađen. <a href="#/tips">Nazad</a></p>`;
      return;
    }
    app.innerHTML = `
      <h1>${tip.title}</h1>
      <div class="tip-meta">${tip.sport} — kvota ${tip.odds} — autor: ${tip.author} — ${formatDate(tip.date)}</div>
      <p>${tip.content}</p>
    `;
  }

  function renderSubmitForm() {
    if(!currentUser) {
      app.innerHTML = `<p>Morate biti prijavljeni da pošaljete tip. <a href="#/login">Prijavite se</a></p>`;
      return;
    }
    app.innerHTML = `
      <h1>Pošalji svoj tip</h1>
      <form id="tipForm">
        <div class="form-group"><label>Naslov</label><input name="title" required /></div>
        <div class="form-group"><label>Sport</label><input name="sport" required /></div>
        <div class="form-group"><label>Kvota</label><input name="odds" /></div>
        <div class="form-group"><label>Obrazloženje</label><textarea name="content" required></textarea></div>
        <button type="submit">Pošalji</button>
      </form>
    `;
    document.getElementById('tipForm').addEventListener('submit', e => {
      e.preventDefault();
      const data = new FormData(e.target);
      tips.unshift({
        id: Date.now(),
        title: data.get('title'),
        sport: data.get('sport'),
        odds: data.get('odds') || '-',
        content: data.get('content'),
        author: currentUser.email,
        date: new Date().toISOString()
      });
      localStorage.setItem('kt_tips', JSON.stringify(tips));
      alert('Tip poslat!');
      location.hash = '#/tips';
    });
  }

  function renderLogin() {
    if (currentUser) {
      app.innerHTML = `<h1>Dobrodošli, ${currentUser.email}</h1>
        <button id="logoutBtn">Odjavi se</button>`;
      document.getElementById('logoutBtn').onclick = () => signOut(auth);
      return;
    }
    app.innerHTML = `
      <h1>Prijava / Registracija</h1>
      <form id="authForm">
        <div class="form-group"><label>Email</label><input name="email" type="email" required /></div>
        <div class="form-group"><label>Lozinka</label><input name="password" type="password" required /></div>
        <button type="submit">Prijavi se</button>
      </form>
      <button id="registerBtn">Registruj se</button>
    `;
    document.getElementById('authForm').addEventListener('submit', e => {
      e.preventDefault();
      const data = new FormData(e.target);
      signInWithEmailAndPassword(auth, data.get('email'), data.get('password'))
        .catch(err => alert(err.message));
    });
    document.getElementById('registerBtn').onclick = () => {
      const email = prompt('Email:');
      const password = prompt('Lozinka:');
      if (email && password) {
        createUserWithEmailAndPassword(auth, email, password)
          .catch(err => alert(err.message));
      }
    };
  }

  function renderNotFound() {
    app.innerHTML = `<p>Stranica nije pronađena. <a href="#/">Početna</a></p>`;
  }

  onAuthStateChanged(auth, user => {
    currentUser = user ? { email: user.email } : null;
    router();
  });

  window.addEventListener('hashchange', router);
})();
</script>

</body>
</html>
